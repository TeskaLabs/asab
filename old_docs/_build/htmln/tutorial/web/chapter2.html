
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Create microservice with REST API &#8212; ASAB  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="The web server" href="../../asab/web/index.html" />
    <link rel="prev" title="Web Server Tutorial" href="chapter1.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="create-microservice-with-rest-api">
<h1>Create microservice with REST API<a class="headerlink" href="#create-microservice-with-rest-api" title="Permalink to this heading">¶</a></h1>
<p>With this tutorial, you will create a basic ASAB microservice that provides a REST HTTP API.
This microservice will implement Create, Read, Update and Delete functionality, in another words CRUD.
MongoDB will be used as the database.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Python version 3.6 or later</p></li>
<li><p>Asynchronous Server App Boilerplate (ASAB) version 20.3 or later</p></li>
<li><p>MongoDB instance</p></li>
<li><p>Postman</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We will use Docker to run MongoDB. Docker installation is not covered in this tutorial, but there are scores of good ones online should you run into any trouble. If you’re not familiar with Docker yet, it is a great opportunity to start (<a class="reference external" href="https://www.docker.com/get-started/">https://www.docker.com/get-started/</a>).</p>
<p>Otherwise, you can install MongoDB following one of these tutorials: <a class="reference external" href="https://www.mongodb.com/docs/manual/installation/">https://www.mongodb.com/docs/manual/installation/</a></p>
</div>
</section>
<section id="components">
<h2>Components<a class="headerlink" href="#components" title="Permalink to this heading">¶</a></h2>
<p>The microservice consists of several modules (aka Python files).
These modules are as follows (and also indicate the file structure) and will be discussed in more detail in the respective sections below, going from top to bottom:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
└── myrestapi.py
─── myrestapi
        └── __init__.py
        ─── app.py
        ─── tutorial
                └── handler.py
                └── service.py
</pre></div>
</div>
</section>
<section id="mongodb">
<h2>MongoDB<a class="headerlink" href="#mongodb" title="Permalink to this heading">¶</a></h2>
<p>To make things simple, let’s use a Docker image.</p>
<p>Pull this image:
<a class="reference external" href="https://hub.docker.com/_/mongo">https://hub.docker.com/_/mongo</a></p>
<p>You can simply use the command below to run it.
If you choose to run the instance without a password,
don’t forget to adjust the related <strong>asab.Config</strong> in <cite>./myrestapi/app.py</cite>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -d -p <span class="m">27017</span>:27017 <span class="se">\</span>
        -e <span class="nv">MONGO_INITDB_ROOT_USERNAME</span><span class="o">=</span>user <span class="se">\</span>
        -e <span class="nv">MONGO_INITDB_ROOT_PASSWORD</span><span class="o">=</span>secret <span class="se">\</span>
        mongo
</pre></div>
</div>
</section>
<section id="postman">
<h2>Postman<a class="headerlink" href="#postman" title="Permalink to this heading">¶</a></h2>
<p>We use Postman to test the webservice REST API.</p>
<p>You can download it here:
<a class="reference external" href="https://www.postman.com/downloads/">https://www.postman.com/downloads/</a></p>
<p>The Postman is fairly straightforward to use.
You can create your collection of HTTP requests, save them, or automatically generate documentation.</p>
</section>
<section id="myrestapi-py">
<h2>myrestapi.py<a class="headerlink" href="#myrestapi-py" title="Permalink to this heading">¶</a></h2>
<p>This is where everything starts.
Begin with the shebang line, which tells the executing operating system <strong>python</strong> should execute this program.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
</pre></div>
</div>
<p>Imports follow. All you need here is the application. It is called <strong>TutorialApp</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myrestapi</span> <span class="kn">import</span> <span class="n">TutorialApp</span>
</pre></div>
</div>
<p>Next, instantiate an application class <cite>TutorialApp</cite> in the __main__ of the application, and run it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">TutorialApp</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="app-py">
<h2>app.py<a class="headerlink" href="#app-py" title="Permalink to this heading">¶</a></h2>
<p><cite>./myrestapi/app.py</cite></p>
<p>Define the application class <cite>TutorialApp</cite>.</p>
<p>Imports first:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asab</span>
<span class="kn">import</span> <span class="nn">asab.web</span>
<span class="kn">import</span> <span class="nn">asab.web.rest</span>
<span class="kn">import</span> <span class="nn">asab.storage</span>
</pre></div>
</div>
<p>Add some default configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">asab</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">add_defaults</span><span class="p">(</span>
<span class="p">{</span>
        <span class="s1">&#39;asab:storage&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;mongodb&#39;</span><span class="p">,</span>
                <span class="s1">&#39;mongodb_uri&#39;</span><span class="p">:</span> <span class="s1">&#39;mongodb://mongouser:mongopassword@mongoipaddress:27017&#39;</span><span class="p">,</span>
                <span class="s1">&#39;mongodb_database&#39;</span><span class="p">:</span> <span class="s1">&#39;mongodatabase&#39;</span>
        <span class="p">},</span>
<span class="p">})</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To make things more simple, Mongo credentials are stored here as a default configuration.
Usually, you provide your app with a configuration file using <cite>-c</cite> commandline option.
Learn more in section <a class="reference internal" href="../../asab/config.html#configuration-ref"><span class="std std-ref">Configuration</span></a>.</p>
</div>
<p>Next, describe the class, it inherits from the basic ASAB Application class,
but you need to expand  it a little:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TutorialApp</span><span class="p">(</span><span class="n">asab</span><span class="o">.</span><span class="n">Application</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
                <span class="c1"># Register modules</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="n">asab</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span>

                <span class="c1"># Locate the web service</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">WebService</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_service</span><span class="p">(</span><span class="s2">&quot;asab.WebService&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">WebContainer</span> <span class="o">=</span> <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">WebContainer</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">WebService</span><span class="p">,</span> <span class="s2">&quot;web&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">WebContainer</span><span class="o">.</span><span class="n">WebApp</span><span class="o">.</span><span class="n">middlewares</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">JsonExceptionMiddleware</span>
                <span class="p">)</span>

                <span class="c1"># Initialize services</span>
                <span class="kn">from</span> <span class="nn">.tutorial.handler</span> <span class="kn">import</span> <span class="n">CRUDWebHandler</span>
                <span class="kn">from</span> <span class="nn">.tutorial.service</span> <span class="kn">import</span> <span class="n">CRUDService</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span> <span class="o">=</span> <span class="n">CRUDService</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CRUDWebHandler</span> <span class="o">=</span> <span class="n">CRUDWebHandler</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span>
                <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="init-py">
<h2>__init__.py<a class="headerlink" href="#init-py" title="Permalink to this heading">¶</a></h2>
<p><cite>./myrestapi/__init__.py</cite></p>
<p>Init file is needed so myrestapi will work as a module.
Just import the TutorialApp.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.app</span> <span class="kn">import</span> <span class="n">TutorialApp</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;TutorialApp&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="handler-py">
<h2>handler.py<a class="headerlink" href="#handler-py" title="Permalink to this heading">¶</a></h2>
<p><cite>./myrestapi/tutorial/handler.py</cite></p>
<p>The handler is where HTTP Rest calls are handled and transformed into the actual (internal) service calls.
From another perspective, the handler should contain only translation between REST calls and the service interface.
No actual ‘business logic’ should be here.
It is strongly suggested to build these CRUD methods one by one and test them straight away.
If you haven’t set up your database test instance yet, now is the time to do it.</p>
<p>As usual, we start by importing modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asab</span>
<span class="kn">import</span> <span class="nn">asab.web.rest</span>
</pre></div>
</div>
<p>Let’s start with two methods - <cite>create</cite> and <cite>read</cite> which allow us to write into database and check the record.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CRUDWebHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">mongo_svc</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span> <span class="o">=</span> <span class="n">mongo_svc</span>
                <span class="n">web_app</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">WebContainer</span><span class="o">.</span><span class="n">WebApp</span>
                <span class="n">web_app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_put</span><span class="p">(</span>
                        <span class="s1">&#39;/crud-myrestapi/</span><span class="si">{collection}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create</span>
                <span class="p">)</span>
                <span class="n">web_app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span>
                        <span class="s1">&#39;/crud-myrestapi/</span><span class="si">{collection}</span><span class="s1">/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">read</span>
                <span class="p">)</span>


        <span class="nd">@asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_schema_handler</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
                <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;field1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;field2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;field3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">}</span>
                <span class="p">}})</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
                <span class="n">collection</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>

                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">json_data</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                                <span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">}</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                                <span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">}</span>
                        <span class="p">)</span>


        <span class="k">async</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                <span class="n">collection</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">key</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                        <span class="n">request</span><span class="p">,</span> <span class="n">response</span>
                <span class="p">)</span>
</pre></div>
</div>
<p>The handler only accepts the incoming requests and returns appropriate responses.
All of the “logic”, be it the specifics of the database connection, additional validations and other
operations take place in the CRUDService.</p>
<p>POST and PUT requests typically come with data in their body.
Providing your <cite>WebContainer</cite> with <cite>JsonExceptionMiddleware</cite> enables you to validate a JSON input using <cite>&#64;asab.web.rest.json_schema_handler</cite> decorator and JSON schema (<a class="reference external" href="https://json-schema.org/">https://json-schema.org/</a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ASAB WebServer is built on top of the aiohttp library.
For further details please visit <a class="reference external" href="https://docs.aiohttp.org/en/stable/index.html">https://docs.aiohttp.org/en/stable/index.html</a>.</p>
</div>
</section>
<section id="service-py">
<h2>service.py<a class="headerlink" href="#service-py" title="Permalink to this heading">¶</a></h2>
<p><cite>./myrestapi/tutorial/service.py</cite></p>
<p>As mentioned above, this is where the inner workings of the microservice request processing are.
Let’s start as usual, by importing the desired modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asab</span>
<span class="kn">import</span> <span class="nn">asab.storage.exceptions</span>
</pre></div>
</div>
<p>We want to start logging in here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="c1">#</span>

<span class="n">L</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">#</span>
</pre></div>
</div>
<p>Now define the CRUDService class which inherits from the <cite>asab.Service</cite> class.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>asab.Service</cite> is a lightweight yet powerful abstract class providing your object with 3 functionalities:</p>
<ul class="simple">
<li><p>Name of the <cite>asab.Service</cite> is registered in the app and can be called from the <cite>app</cite> object anywhere in your code.</p></li>
<li><p><cite>asab.Service</cite> class implements <cite>initialize()</cite> and <cite>finalize()</cite> coroutines which help you to handle asynchronous operations in init and exit time of your application.</p></li>
<li><p><cite>asab.Service</cite> registers application object as <cite>self.App</cite> for you.</p></li>
</ul>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CRUDService</span><span class="p">(</span><span class="n">asab</span><span class="o">.</span><span class="n">Service</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;crud.CRUDService&#39;</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">service_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MongoDBStorageService</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get_service</span><span class="p">(</span>
                        <span class="s2">&quot;asab.StorageService&quot;</span>
                <span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
                <span class="n">obj_id</span> <span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">)</span>

                <span class="n">cre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MongoDBStorageService</span><span class="o">.</span><span class="n">upsertor</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span>
                <span class="p">)</span>

                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                        <span class="n">json_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">json_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="p">):</span>
                        <span class="n">cre</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                        <span class="k">await</span> <span class="n">cre</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
                        <span class="k">return</span> <span class="s2">&quot;OK&quot;</span>
                <span class="k">except</span> <span class="n">asab</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">DuplicateError</span><span class="p">:</span>
                        <span class="n">L</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="s2">&quot;Document you are trying to create already exists.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">MongoDBStorageService</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p><cite>asab.StorageService</cite> initialized in <cite>app.py</cite> as part of the <cite>asab.storage.Module</cite> enables connection to MongoDB.
Further on, two methods provide the handler with the desired functionalities.</p>
</section>
<section id="now-test-it">
<h2>Now test it!<a class="headerlink" href="#now-test-it" title="Permalink to this heading">¶</a></h2>
<p>The application is implicitly running on an <strong>8080</strong> port.
Open the Postman and set a new request.</p>
<p>Try the PUT method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">crud</span><span class="o">-</span><span class="n">myrestapi</span><span class="o">/</span><span class="n">movie</span>
</pre></div>
</div>
<p>Insert into the request body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="s2">&quot;field1&quot;</span><span class="p">:</span> <span class="s2">&quot;something new&quot;</span><span class="p">,</span>
<span class="s2">&quot;field2&quot;</span><span class="p">:</span> <span class="mi">5555</span><span class="p">,</span>
<span class="s2">&quot;field3&quot;</span><span class="p">:</span> <span class="mi">44424</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When there’s a record in your database, try to read it!
For example with this GET request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">crud</span><span class="o">-</span><span class="n">myrestapi</span><span class="o">/</span><span class="n">movie</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<p>Is your response with a 200 status code? Does it return desired data?</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>TROUBLESHOOTING</strong></p>
<p><strong>ERROR</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">&#39;pymongo.mongo_replica_set_client&#39;</span>
</pre></div>
</div>
<p>Try:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">motor</span>
</pre></div>
</div>
<p><strong>ERROR</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">OSError</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">98</span><span class="p">]</span> <span class="n">error</span> <span class="k">while</span> <span class="n">attempting</span> <span class="n">to</span> <span class="n">bind</span> <span class="n">on</span> <span class="n">address</span> <span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">):</span> <span class="n">address</span> <span class="n">already</span> <span class="ow">in</span> <span class="n">use</span>
</pre></div>
</div>
<p>Try to kill process listening on 8080 or add [web] section into configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asab</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">add_defaults</span><span class="p">(</span>
<span class="p">{</span>
        <span class="s1">&#39;asab:storage&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;mongodb&#39;</span><span class="p">,</span>
                <span class="s1">&#39;mongodb_uri&#39;</span><span class="p">:</span> <span class="s1">&#39;mongodb://mongouser:mongopassword@mongoipaddress:27017&#39;</span><span class="p">,</span>
                <span class="s1">&#39;mongodb_database&#39;</span><span class="p">:</span> <span class="s1">&#39;mongodatabase&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;web&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;listen&#39;</span><span class="p">:</span> <span class="s1">&#39;0.0.0.0 8081&#39;</span>
        <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p><strong>ERROR</strong></p>
<p>No error at all, no response either.</p>
<p>Try to check the Mongo database credentials. Do your credentials in the configuration in <cite>app.py</cite> fit the ones you entered when running the Mongo Docker image?</p>
</div>
<p>Up and running! Congratulation on your first ASAB microservice!</p>
<p>Oh, wait…</p>
<p><strong>C</strong>, <strong>R</strong>… What about <strong>Update</strong> and <strong>Delete</strong> you ask?</p>
<p>You already know everything to add the next functionality! Accept the challenge and try it yourself! Or check out the code below.</p>
</section>
<section id="update-and-delete">
<h2>Update and Delete<a class="headerlink" href="#update-and-delete" title="Permalink to this heading">¶</a></h2>
<p><strong>handler.py</strong></p>
<p><cite>./myrestapi/tutorial/handler.py</cite></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asab</span>
<span class="kn">import</span> <span class="nn">asab.web.rest</span>


<span class="k">class</span> <span class="nc">CRUDWebHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">mongo_svc</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span> <span class="o">=</span> <span class="n">mongo_svc</span>
                <span class="n">web_app</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">WebContainer</span><span class="o">.</span><span class="n">WebApp</span>
                <span class="n">web_app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_put</span><span class="p">(</span>
                        <span class="s1">&#39;/crud-myrestapi/</span><span class="si">{collection}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create</span>
                <span class="p">)</span>
                <span class="n">web_app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span>
                        <span class="s1">&#39;/crud-myrestapi/</span><span class="si">{collection}</span><span class="s1">/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">read</span>
                <span class="p">)</span>
                <span class="n">web_app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_put</span><span class="p">(</span>
                        <span class="s1">&#39;/crud-myrestapi/</span><span class="si">{collection}</span><span class="s1">/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">update</span>
                <span class="p">)</span>
                <span class="n">web_app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_delete</span><span class="p">(</span>
                        <span class="s1">&#39;/crud-myrestapi/</span><span class="si">{collection}</span><span class="s1">/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span>
                <span class="p">)</span>


        <span class="nd">@asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_schema_handler</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
                <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;field1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;field2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;field3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">}</span>
                <span class="p">}})</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
                <span class="n">collection</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>

                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">json_data</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                                <span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">}</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                                <span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">}</span>
                        <span class="p">)</span>


        <span class="k">async</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                <span class="n">collection</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">key</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                        <span class="n">request</span><span class="p">,</span> <span class="n">response</span>
                <span class="p">)</span>


        <span class="nd">@asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_schema_handler</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
                <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;field1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;field2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;field3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">}</span>
                <span class="p">}})</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
                <span class="n">collection</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>
                <span class="n">obj_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">json_data</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                                <span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">}</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                                <span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">}</span>
                        <span class="p">)</span>


        <span class="k">async</span> <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
                <span class="n">collection</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>
                <span class="n">obj_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">CRUDService</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                                <span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">}</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="n">asab</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span>
                                <span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">}</span>
                        <span class="p">)</span>
</pre></div>
</div>
<p><strong>service.py</strong></p>
<p><cite>./myrestapi/tutorial/service.py</cite></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asab</span>
<span class="kn">import</span> <span class="nn">asab.storage.exceptions</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="c1">#</span>

<span class="n">L</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">#</span>


<span class="k">class</span> <span class="nc">CRUDService</span><span class="p">(</span><span class="n">asab</span><span class="o">.</span><span class="n">Service</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;crud.CRUDService&#39;</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">service_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MongoDBStorageService</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get_service</span><span class="p">(</span>
                        <span class="s2">&quot;asab.StorageService&quot;</span>
                <span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
                <span class="n">obj_id</span> <span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">)</span>

                <span class="n">cre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MongoDBStorageService</span><span class="o">.</span><span class="n">upsertor</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span>
                <span class="p">)</span>

                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                        <span class="n">json_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">json_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="p">):</span>
                        <span class="n">cre</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                        <span class="k">await</span> <span class="n">cre</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
                        <span class="k">return</span> <span class="s2">&quot;OK&quot;</span>
                <span class="k">except</span> <span class="n">asab</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">DuplicateError</span><span class="p">:</span>
                        <span class="n">L</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="s2">&quot;Document you are trying to create already exists.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>


        <span class="k">async</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">MongoDBStorageService</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>


        <span class="k">async</span> <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
                <span class="n">original</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span>
                <span class="p">)</span>

                <span class="n">cre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MongoDBStorageService</span><span class="o">.</span><span class="n">upsertor</span><span class="p">(</span>
                        <span class="n">collection</span><span class="p">,</span> <span class="n">original</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">],</span> <span class="n">original</span><span class="p">[</span><span class="s2">&quot;_v&quot;</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                        <span class="n">document</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">document</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="p">):</span>
                        <span class="n">cre</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                        <span class="k">await</span> <span class="n">cre</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
                        <span class="k">return</span> <span class="s2">&quot;OK&quot;</span>

                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">None</span>


        <span class="k">async</span> <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">MongoDBStorageService</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                                <span class="n">collection</span><span class="p">,</span> <span class="n">obj_id</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ASAB</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter1.html">Web Server Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Create microservice with REST API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asab/web/index.html">The web server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/web/restapidocs.html">REST API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/web/authn.html">Authn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/web/cors.html">Cross-Origin Resource Sharing (CORS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/alert.html">Alert Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asab/application.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/log.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/pubsub.html">Publish-Subscribe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/service.html">Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/module.html">Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/various.html">Various utility classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/zookeeper.html">Zookeeper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/library.html">Library</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/command-line.html">ASAB Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/containers.html">Containerisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/systemd.html">systemd</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="chapter1.html" title="previous chapter">Web Server Tutorial</a></li>
      <li>Next: <a href="../../asab/web/index.html" title="next chapter">The web server</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, TeskaLabs Ltd..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/tutorial/web/chapter2.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>