
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>asab.log &#8212; ASAB  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for asab.log</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">logging.handlers</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">queue</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>

<span class="kn">from</span> <span class="nn">.config</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">.timer</span> <span class="kn">import</span> <span class="n">Timer</span>

<span class="c1"># Non-error/warning type of message that is visible without -v flag</span>
<span class="n">LOG_NOTICE</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">logging</span><span class="o">.</span><span class="n">addLevelName</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span> <span class="s2">&quot;NOTICE&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="Logging"><a class="viewcode-back" href="../../asab/log.html#asab.log.Logging">[docs]</a><span class="k">class</span> <span class="nc">Logging</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>


	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">ConsoleHandler</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">hasHandlers</span><span class="p">():</span>

			<span class="c1"># Add console logger if needed</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">isatty</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ASABFORCECONSOLE&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_configure_console_logging</span><span class="p">()</span>

			<span class="c1"># Initialize file handler</span>
			<span class="n">file_path</span> <span class="o">=</span> <span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:file&quot;</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>

			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

				<span class="c1"># Ensure file path</span>
				<span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
					<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">RotatingFileHandler</span><span class="p">(</span>
					<span class="n">file_path</span><span class="p">,</span>
					<span class="n">backupCount</span><span class="o">=</span><span class="n">Config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s2">&quot;logging:file&quot;</span><span class="p">,</span> <span class="s2">&quot;backup_count&quot;</span><span class="p">),</span>
					<span class="n">maxBytes</span><span class="o">=</span><span class="n">Config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s2">&quot;logging:file&quot;</span><span class="p">,</span> <span class="s2">&quot;backup_max_bytes&quot;</span><span class="p">),</span>
				<span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">StructuredDataFormatter</span><span class="p">(</span>
					<span class="n">fmt</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:file&quot;</span><span class="p">][</span><span class="s2">&quot;format&quot;</span><span class="p">],</span>
					<span class="n">datefmt</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:file&quot;</span><span class="p">][</span><span class="s2">&quot;datefmt&quot;</span><span class="p">],</span>
					<span class="n">sd_id</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;sd_id&quot;</span><span class="p">],</span>
				<span class="p">))</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">)</span>

				<span class="n">rotate_every</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logging:file&quot;</span><span class="p">,</span> <span class="s2">&quot;rotate_every&quot;</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">rotate_every</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
					<span class="n">rotate_every</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^([0-9]+)([dMHs])$&quot;</span><span class="p">,</span> <span class="n">rotate_every</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">rotate_every</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
						<span class="n">i</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">rotate_every</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
						<span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;rotate_every&#39; configuration value.&quot;</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span>
								<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
							<span class="k">elif</span> <span class="n">u</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
								<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">60</span>
							<span class="k">elif</span> <span class="n">u</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
								<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span>
							<span class="k">elif</span> <span class="n">u</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
								<span class="k">pass</span>

							<span class="c1"># PubSub is not ready at this moment, we need to create timer in a future</span>
							<span class="k">async</span> <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">LogRotatingTime</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_tick_rotate_check</span><span class="p">,</span> <span class="n">autorestart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">LogRotatingTime</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
							<span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">schedule</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;rotate_every&#39; configuration value.&quot;</span><span class="p">)</span>

			<span class="c1"># Initialize syslog</span>
			<span class="k">if</span> <span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:syslog&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">):</span>

				<span class="n">address</span> <span class="o">=</span> <span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:syslog&quot;</span><span class="p">][</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>

				<span class="k">if</span> <span class="n">address</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span> <span class="o">=</span> <span class="n">AsyncIOHandler</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">Loop</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

				<span class="k">else</span><span class="p">:</span>
					<span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>

					<span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s1">&#39;tcp&#39;</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span> <span class="o">=</span> <span class="n">AsyncIOHandler</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">Loop</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="p">(</span>
							<span class="n">url</span><span class="o">.</span><span class="n">hostname</span> <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">hostname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
							<span class="n">url</span><span class="o">.</span><span class="n">port</span> <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">SYSLOG_UDP_PORT</span>
						<span class="p">))</span>

					<span class="k">elif</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s1">&#39;udp&#39;</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span> <span class="o">=</span> <span class="n">AsyncIOHandler</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">Loop</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="p">(</span>
							<span class="n">url</span><span class="o">.</span><span class="n">hostname</span> <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">hostname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
							<span class="n">url</span><span class="o">.</span><span class="n">port</span> <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">SYSLOG_UDP_PORT</span>
						<span class="p">))</span>

					<span class="k">elif</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s1">&#39;unix-connect&#39;</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span> <span class="o">=</span> <span class="n">AsyncIOHandler</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">Loop</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

					<span class="k">elif</span> <span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s1">&#39;unix-sendto&#39;</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span> <span class="o">=</span> <span class="n">AsyncIOHandler</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">Loop</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Invalid logging:syslog address &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>
						<span class="n">address</span> <span class="o">=</span> <span class="kc">None</span>

				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
					<span class="nb">format</span> <span class="o">=</span> <span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:syslog&quot;</span><span class="p">][</span><span class="s2">&quot;format&quot;</span><span class="p">]</span>
					<span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">MacOSXSyslogFormatter</span><span class="p">(</span><span class="n">sd_id</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;sd_id&quot;</span><span class="p">]))</span>
					<span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">SyslogRFC5424Formatter</span><span class="p">(</span><span class="n">sd_id</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;sd_id&quot;</span><span class="p">]))</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">SyslogRFC3164Formatter</span><span class="p">(</span><span class="n">sd_id</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;sd_id&quot;</span><span class="p">]))</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span><span class="p">)</span>

			<span class="c1"># No logging is configured</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConsoleHandler</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">SyslogHandler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="c1"># Let&#39;s check if we run in Docker and if so, then log on stderr</span>
				<span class="kn">from</span> <span class="nn">.docker</span> <span class="kn">import</span> <span class="n">running_in_docker</span>
				<span class="k">if</span> <span class="n">running_in_docker</span><span class="p">():</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_configure_console_logging</span><span class="p">()</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Logging seems to be already configured. Proceed with caution.&quot;</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s2">&quot;verbose&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;level&quot;</span><span class="p">])</span>

		<span class="c1"># Fine-grained log level configurations</span>
		<span class="n">levels</span> <span class="o">=</span> <span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;levels&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">levelconf</span> <span class="ow">in</span> <span class="n">levels</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
			<span class="n">levelconf</span> <span class="o">=</span> <span class="n">levelconf</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">levelconf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">levelconf</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">levelconf</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">loggername</span><span class="p">,</span> <span class="n">levelname</span> <span class="o">=</span> <span class="n">levelconf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLevelName</span><span class="p">(</span><span class="n">levelname</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
			<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">loggername</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>


<div class="viewcode-block" id="Logging.rotate"><a class="viewcode-back" href="../../asab/log.html#asab.log.Logging.rotate">[docs]</a>	<span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span> <span class="s2">&quot;Rotating logs&quot;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span><span class="o">.</span><span class="n">doRollover</span><span class="p">()</span></div>


	<span class="k">async</span> <span class="k">def</span> <span class="nf">_on_tick_rotate_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">FileHandler</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">()</span>


	<span class="k">def</span> <span class="nf">_configure_console_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ConsoleHandler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

		<span class="c1"># Disable colors when running in container</span>
		<span class="kn">from</span> <span class="nn">.docker</span> <span class="kn">import</span> <span class="n">running_in_container</span>
		<span class="k">if</span> <span class="n">running_in_container</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ConsoleHandler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">StructuredDataFormatter</span><span class="p">(</span>
				<span class="n">fmt</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:console&quot;</span><span class="p">][</span><span class="s2">&quot;format&quot;</span><span class="p">],</span>
				<span class="n">datefmt</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:console&quot;</span><span class="p">][</span><span class="s2">&quot;datefmt&quot;</span><span class="p">],</span>
				<span class="n">sd_id</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;sd_id&quot;</span><span class="p">],</span>
				<span class="n">use_color</span><span class="o">=</span><span class="kc">False</span>
			<span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ConsoleHandler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">StructuredDataFormatter</span><span class="p">(</span>
				<span class="n">fmt</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:console&quot;</span><span class="p">][</span><span class="s2">&quot;format&quot;</span><span class="p">],</span>
				<span class="n">datefmt</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging:console&quot;</span><span class="p">][</span><span class="s2">&quot;datefmt&quot;</span><span class="p">],</span>
				<span class="n">sd_id</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;sd_id&quot;</span><span class="p">],</span>
				<span class="n">use_color</span><span class="o">=</span><span class="kc">True</span>
			<span class="p">))</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">ConsoleHandler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">RootLogger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConsoleHandler</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">_StructuredDataLogger</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">This class extends a default python logger class, specifically by adding ``struct_data`` parameter to logging functions.</span>
<span class="sd">It means that you can use expressions such as ``logger.info(&quot;Hello world!&quot;, struct_data={&#39;key&#39;:&#39;value&#39;})``.</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">struct_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stack_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">struct_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">extra</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">extra</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
			<span class="n">extra</span><span class="p">[</span><span class="s1">&#39;_struct_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct_data</span>

		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">exc_info</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">extra</span><span class="p">,</span> <span class="n">stack_info</span><span class="o">=</span><span class="n">stack_info</span><span class="p">)</span>


<span class="n">logging</span><span class="o">.</span><span class="n">setLoggerClass</span><span class="p">(</span><span class="n">_StructuredDataLogger</span><span class="p">)</span>


<div class="viewcode-block" id="StructuredDataFormatter"><a class="viewcode-back" href="../../asab/log.html#asab.log.StructuredDataFormatter">[docs]</a><span class="k">class</span> <span class="nc">StructuredDataFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	The logging formatter that renders log messages that includes structured data.</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">empty_sd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
	<span class="n">BLACK</span><span class="p">,</span> <span class="n">RED</span><span class="p">,</span> <span class="n">GREEN</span><span class="p">,</span> <span class="n">YELLOW</span><span class="p">,</span> <span class="n">BLUE</span><span class="p">,</span> <span class="n">MAGENTA</span><span class="p">,</span> <span class="n">CYAN</span><span class="p">,</span> <span class="n">WHITE</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>


	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">sd_id</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">,</span> <span class="n">use_color</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">datefmt</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SD_id</span> <span class="o">=</span> <span class="n">sd_id</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Facility</span> <span class="o">=</span> <span class="n">facility</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">UseColor</span> <span class="o">=</span> <span class="n">use_color</span>


<div class="viewcode-block" id="StructuredDataFormatter.format"><a class="viewcode-back" href="../../asab/log.html#asab.log.StructuredDataFormatter.format">[docs]</a>	<span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Format the specified record as text.</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="n">record</span><span class="o">.</span><span class="n">struct_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_struct_data</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_struct_data&quot;</span><span class="p">))</span>

		<span class="c1"># The Priority value is calculated by first multiplying the Facility number by 8 and then adding the numerical value of the Severity.</span>
		<span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">&lt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
			<span class="n">severity</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c1"># Debug</span>
			<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BLUE</span>
		<span class="k">elif</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">&lt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span>
			<span class="n">severity</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1"># Informational</span>
			<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GREEN</span>
		<span class="k">elif</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">&lt;=</span> <span class="n">LOG_NOTICE</span><span class="p">:</span>
			<span class="n">severity</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Notice</span>
			<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CYAN</span>
		<span class="k">elif</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">&lt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">:</span>
			<span class="n">severity</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Warning</span>
			<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">YELLOW</span>
		<span class="k">elif</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">&lt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
			<span class="n">severity</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Error</span>
			<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RED</span>
		<span class="k">elif</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">&lt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span>
			<span class="n">severity</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Critical</span>
			<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAGENTA</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">severity</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Alert</span>
			<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">WHITE</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">UseColor</span><span class="p">:</span>
			<span class="n">levelname</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">levelname</span>
			<span class="n">levelname_color</span> <span class="o">=</span> <span class="n">_COLOR_SEQ</span> <span class="o">%</span> <span class="p">(</span><span class="mi">30</span> <span class="o">+</span> <span class="n">color</span><span class="p">)</span> <span class="o">+</span> <span class="n">levelname</span> <span class="o">+</span> <span class="n">_RESET_SEQ</span>
			<span class="n">record</span><span class="o">.</span><span class="n">levelname</span> <span class="o">=</span> <span class="n">levelname_color</span>

		<span class="n">record</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Facility</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">severity</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">)</span></div>


<div class="viewcode-block" id="StructuredDataFormatter.formatTime"><a class="viewcode-back" href="../../asab/log.html#asab.log.StructuredDataFormatter.formatTime">[docs]</a>	<span class="k">def</span> <span class="nf">formatTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Return the creation time of the specified LogRecord as formatted text.</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">ct</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">created</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">datefmt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">s</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datefmt</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">t</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
				<span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%03d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">msecs</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">s</span>
		<span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR when logging: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span></div>


<div class="viewcode-block" id="StructuredDataFormatter.render_struct_data"><a class="viewcode-back" href="../../asab/log.html#asab.log.StructuredDataFormatter.render_struct_data">[docs]</a>	<span class="k">def</span> <span class="nf">render_struct_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">struct_data</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Return the string with structured data.</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="k">if</span> <span class="n">struct_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_sd</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{sd_id}</span><span class="s2"> </span><span class="si">{sd_params}</span><span class="s2">] &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
				<span class="n">sd_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SD_id</span><span class="p">,</span>
				<span class="n">sd_params</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">=&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">struct_data</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span></div></div>



<span class="k">def</span> <span class="nf">_loop_exception_handler</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	This is an logging exception handler for asyncio.</span>
<span class="sd">	It&#39;s purpose is to nicely log any unhandled excpetion that arises in the asyncio tasks.</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">exception</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

	<span class="n">message</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">message</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">message</span> <span class="o">+=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ex_traceback</span> <span class="o">=</span> <span class="n">exception</span><span class="o">.</span><span class="n">__traceback__</span>
		<span class="n">tb_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">ex_traceback</span><span class="p">)]</span>
		<span class="n">message</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tb_lines</span><span class="p">)</span>

	<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<div class="viewcode-block" id="MacOSXSyslogFormatter"><a class="viewcode-back" href="../../asab/log.html#asab.log.MacOSXSyslogFormatter">[docs]</a><span class="k">class</span> <span class="nc">MacOSXSyslogFormatter</span><span class="p">(</span><span class="n">StructuredDataFormatter</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	It implements Syslog formatting for Mac OSX syslog (aka format ``m``).</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">sd_id</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">):</span>
		<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">%(priority)s</span><span class="s1">&gt;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">{app_name}</span><span class="s1">[</span><span class="si">{proc_id}</span><span class="s1">]: </span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(struct_data)s%(message)s</span><span class="se">\000</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
			<span class="n">app_name</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;app_name&quot;</span><span class="p">],</span>
			<span class="n">proc_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
		<span class="p">)</span>

		<span class="c1"># Initialize formatter</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">sd_id</span><span class="o">=</span><span class="n">sd_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="SyslogRFC3164Formatter"><a class="viewcode-back" href="../../asab/log.html#asab.log.SyslogRFC3164Formatter">[docs]</a><span class="k">class</span> <span class="nc">SyslogRFC3164Formatter</span><span class="p">(</span><span class="n">StructuredDataFormatter</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Implementation of a legacy or BSD Syslog (RFC 3164) formatting (aka format ``3``).</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">sd_id</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">):</span>
		<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">%(priority)s</span><span class="s1">&gt;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">{hostname}</span><span class="s1"> </span><span class="si">{app_name}</span><span class="s1">[</span><span class="si">{proc_id}</span><span class="s1">]:</span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(struct_data)s%(message)s</span><span class="se">\000</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
			<span class="n">app_name</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;app_name&quot;</span><span class="p">],</span>
			<span class="n">hostname</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span>
			<span class="n">proc_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
		<span class="p">)</span>

		<span class="c1"># Initialize formatter</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">sd_id</span><span class="o">=</span><span class="n">sd_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="SyslogRFC5424Formatter"><a class="viewcode-back" href="../../asab/log.html#asab.log.SyslogRFC5424Formatter">[docs]</a><span class="k">class</span> <span class="nc">SyslogRFC5424Formatter</span><span class="p">(</span><span class="n">StructuredDataFormatter</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	It implements Syslog formatting for Mac OSX syslog (aka format ``5``).</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">empty_sd</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">sd_id</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">):</span>
		<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">%(priority)s</span><span class="s1">&gt;1 </span><span class="si">%(asctime)s</span><span class="s1">.</span><span class="si">%(msecs)d</span><span class="s1">Z </span><span class="si">{hostname}</span><span class="s1"> </span><span class="si">{app_name}</span><span class="s1"> </span><span class="si">{proc_id}</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> [log l=&quot;</span><span class="si">%(levelname)s</span><span class="s1">&quot;]</span><span class="si">%(struct_data)s%(message)s</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
			<span class="n">app_name</span><span class="o">=</span><span class="n">Config</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">][</span><span class="s2">&quot;app_name&quot;</span><span class="p">],</span>
			<span class="n">hostname</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span>
			<span class="n">proc_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
		<span class="p">)</span>

		<span class="c1"># Initialize formatter</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">sd_id</span><span class="o">=</span><span class="n">sd_id</span><span class="p">)</span>

		<span class="c1"># Convert time to GMT</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">converter</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span></div>


<div class="viewcode-block" id="AsyncIOHandler"><a class="viewcode-back" href="../../asab/log.html#asab.log.AsyncIOHandler">[docs]</a><span class="k">class</span> <span class="nc">AsyncIOHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="p">):</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">A logging handler similar to a standard ``logging.handlers.SocketHandler`` that utilizes ``asyncio``.</span>
<span class="sd">It implements a queue for decoupling logging from a networking. The networking is fully event-driven via ``asyncio`` mechanisms.</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">sock_type</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">facility</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">SysLogHandler</span><span class="o">.</span><span class="n">LOG_LOCAL1</span><span class="p">):</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_family</span> <span class="o">=</span> <span class="n">family</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">sock_type</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_address</span> <span class="o">=</span> <span class="n">address</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">loop</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_socket</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connect</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">)</span>


	<span class="k">def</span> <span class="nf">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_write_ready</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">remove_reader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_socket</span> <span class="o">=</span> <span class="kc">None</span>


	<span class="k">def</span> <span class="nf">_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_family</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">setblocking</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error when opening syslog connection to &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
			<span class="k">return</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_write</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">add_reader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_read</span><span class="p">)</span>


	<span class="k">def</span> <span class="nf">_on_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_write_ready</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="p">)</span>

		<span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
			<span class="c1"># TODO: Handle eventual error in writing -&gt; break the cycle and restart on write handler</span>
			<span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


	<span class="k">def</span> <span class="nf">_on_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
			<span class="c1"># We receive &quot;something&quot; ... let&#39;s ignore that!</span>
			<span class="k">return</span>
		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error on the syslog socket &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

		<span class="c1"># Close a socket - there is no reason for reading or socket is actually closed</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>


<div class="viewcode-block" id="AsyncIOHandler.emit"><a class="viewcode-back" href="../../asab/log.html#asab.log.AsyncIOHandler.emit">[docs]</a>	<span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		This is the entry point for log entries.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error when writing to syslog &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_enqueue</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_enqueue</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>


		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error when emit to syslog &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">handleError</span><span class="p">(</span><span class="n">record</span><span class="p">)</span></div>


	<span class="k">def</span> <span class="nf">_enqueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">record</span><span class="p">)</span></div>


<span class="n">_RESET_SEQ</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
<span class="n">_COLOR_SEQ</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;</span><span class="si">%d</span><span class="s2">m&quot;</span>
<span class="n">_BOLD_SEQ</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m&quot;</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ASAB</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../get-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/web/chapter1.html">Web Server Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/web/chapter2.html">Create microservice with REST API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asab/web/index.html">The web server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/web/restapidocs.html">REST API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/web/authn.html">Authn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/web/cors.html">Cross-Origin Resource Sharing (CORS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/alert.html">Alert Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asab/application.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/log.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/pubsub.html">Publish-Subscribe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/service.html">Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/module.html">Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/various.html">Various utility classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/zookeeper.html">Zookeeper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asab/library.html">Library</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/command-line.html">ASAB Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/containers.html">Containerisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/systemd.html">systemd</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, TeskaLabs Ltd..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>